<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant JSON Generator</title>
    <!-- Inter font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Plant JSON Generator ðŸŒ¿</h1>
        <p class="text-center text-gray-600 mb-6">
            Enter a plant name to generate a structured JSON file.
        </p>

        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <input type="text" id="plant-name" placeholder="e.g., Sansevieria trifasciata"
                   class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
            <button id="generate-btn"
                    class="p-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition-colors shadow-md">
                Generate JSON
            </button>
        </div>

        <div id="loading" class="text-center text-green-600 font-semibold hidden">
            Generating JSON, please wait...
        </div>

        <div id="output-container" class="mt-6 hidden">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">Generated JSON:</h3>
            <div class="bg-gray-800 text-white rounded-lg shadow-inner overflow-x-auto p-4 relative">
                <button id="copy-btn" class="absolute top-2 right-2 text-gray-400 hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                </button>
                <pre id="json-output" class="text-sm"></pre>
            </div>
            <div id="copy-message" class="text-green-600 text-sm text-center mt-2 hidden">
                Copied to clipboard!
            </div>
        </div>

        <div id="error-message" class="text-red-500 text-center font-semibold mt-4 hidden">
            There was an error generating the JSON. Please try again.
        </div>
    </div>

    <script>
        document.getElementById('generate-btn').addEventListener('click', generateJson);
        document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
        document.getElementById('plant-name').addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                generateBtn.click();
            }
        });

        const generateBtn = document.getElementById('generate-btn');
        const plantNameInput = document.getElementById('plant-name');
        const loadingDiv = document.getElementById('loading');
        const outputContainer = document.getElementById('output-container');
        const jsonOutput = document.getElementById('json-output');
        const copyMessage = document.getElementById('copy-message');
        const errorMessage = document.getElementById('error-message');

        async function generateJson() {
            const plantName = plantNameInput.value.trim();
            if (!plantName) {
                alert('Please enter a plant name.');
                return;
            }

            // Show loading state and hide previous results/errors
            loadingDiv.classList.remove('hidden');
            outputContainer.classList.add('hidden');
            errorMessage.classList.add('hidden');
            copyMessage.classList.add('hidden');
            generateBtn.disabled = true;

            const prompt = `Generate a JSON object for the plant "${plantName}". The JSON should follow this exact structure, including all keys and nested objects. Do not include any extra text or markdown, just the JSON object. All values should be filled based on the characteristics of the plant.

{
  "id": "plant-id",
  "scientificName": "Scientific name of the plant",
  "etymology": "Etymology of the scientific name.",
  "history": "Brief history and origin of the plant.",
  "commonNames": ["Common Name 1", "Common Name 2"],
  "image": "images/plant-folder/image1.jpg",
  "gallery": ["images/plant-folder/image1.jpg", "images/plant-folder/image2.jpg", "images/plant-folder/image3.jpg"],
  "tags": ["tag1", "tag2"],
  "care": {
    "description": "Short description of care.",
    "tips": ["Tip 1", "Tip 2"],
    "issues": ["<strong>Issue 1:</strong> cause and solution.", "<strong>Issue 2:</strong> cause and solution."],
    "detail": "Detailed paragraph on overall care.",
    "howToImages": ["images/plant-folder/care1.jpg", "images/plant-folder/care2.jpg"]
  },
  "watering": {
    "description": "Short description of watering.",
    "tips": ["Tip 1", "Tip 2"],
    "issues": ["Issue with watering"],
    "detail": "Detailed paragraph on watering needs.",
    "frequency": "Watering frequency",
    "howToImages": ["images/plant-folder/watering1.jpg", "images/plant-folder/watering2.jpg"]
  },
  "light": {
    "description": "Short description of light needs.",
    "idealHours": "Ideal hours of light",
    "detail": "Detailed paragraph on light needs.",
    "howToImages": ["images/plant-folder/light1.jpg", "images/plant-folder/light2.jpg"],
    "tips": ["Tip 1", "Tip 2"]
  },
  "medium": {
    "description": "Short description of growing medium.",
    "detail": "Detailed paragraph on soil mix.",
    "howToImages": ["images/plant-folder/medium1.jpg", "images/plant-folder/medium2.jpg"],
    "tips": ["Tip 1", "Tip 2"]
  },
  "propagation": {
    "description": "Short description of propagation method.",
    "detail": "Detailed paragraph on propagation.",
    "tips": ["Tip 1", "Tip 2"],
    "howToImages": ["images/plant-folder/prop1.jpg", "images/plant-folder/prop2.jpg"]
  },
  "issues": {
    "description": "Short description of common issues.",
    "image": ["images/plant-folder/issue1.jpg", "images/plant-folder/issue2.jpg"],
    "tips": ["Tip 1"]
  },
  "toxicity": {
    "description": "Toxicity information."
  }
}
`;

            let retryCount = 0;
            const maxRetries = 3;

            async function callApi() {
                try {
                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                "type": "OBJECT",
                                "properties": {
                                    "id": { "type": "STRING" },
                                    "scientificName": { "type": "STRING" },
                                    "etymology": { "type": "STRING" },
                                    "history": { "type": "STRING" },
                                    "commonNames": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    },
                                    "image": { "type": "STRING" },
                                    "gallery": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    },
                                    "tags": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    },
                                    "care": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "issues": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "detail": { "type": "STRING" },
                                            "howToImages": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "watering": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "issues": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "detail": { "type": "STRING" },
                                            "frequency": { "type": "STRING" },
                                            "howToImages": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "light": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "idealHours": { "type": "STRING" },
                                            "detail": { "type": "STRING" },
                                            "howToImages": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "medium": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "detail": { "type": "STRING" },
                                            "howToImages": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "propagation": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "detail": { "type": "STRING" },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "howToImages": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "issues": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" },
                                            "image": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            },
                                            "tips": {
                                                "type": "ARRAY",
                                                "items": { "type": "STRING" }
                                            }
                                        }
                                    },
                                    "toxicity": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "description": { "type": "STRING" }
                                        }
                                    }
                                }
                            }
                        }
                    };
                    const apiKey = "AIzaSyDACOQup7wBMIAvq_TG9GUMYLXgxh2oTIo";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retryCount < maxRetries) {
                            const delay = Math.pow(2, retryCount) * 1000;
                            retryCount++;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            return callApi();
                        } else {
                            throw new Error(`API call failed with status: ${response.status}`);
                        }
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const jsonText = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(jsonText);
                        jsonOutput.textContent = JSON.stringify(parsedJson, null, 2);
                        outputContainer.classList.remove('hidden');
                    } else {
                        throw new Error('Unexpected API response format.');
                    }
                } catch (error) {
                    errorMessage.classList.remove('hidden');
                    console.error("API call error:", error);
                } finally {
                    loadingDiv.classList.add('hidden');
                    generateBtn.disabled = false;
                }
            }
            callApi();
        }

        function copyToClipboard() {
            const textToCopy = jsonOutput.textContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                copyMessage.classList.remove('hidden');
                setTimeout(() => copyMessage.classList.add('hidden'), 2000);
            }).catch(err => {
                // Fallback for older browsers or if clipboard permission is denied
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    copyMessage.classList.remove('hidden');
                    setTimeout(() => copyMessage.classList.add('hidden'), 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
                document.body.removeChild(textarea);
            });
        }
    </script>
</body>
</html>
