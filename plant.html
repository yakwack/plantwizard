<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Plant Profile</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="..." crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Homenaje&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <h1 class="logo"><img src="images/wiz_logo.png" height="64px"> Plant Wizard</h1>
    <nav><a href="index.html">Back to Directory</a></nav>
  </header>

  <main id="plant-profile" class="container"></main>

<script>
    async function loadPlant() {
      // Get the plant ID from the URL
      const params = new URLSearchParams(window.location.search);
      const plantId = params.get("id");

      if (!plantId) {
        document.getElementById("plant-profile").innerHTML = "<p>No plant selected.</p>";
        return;
      }

      try {
        // Fetch the specific JSON file for the plant (assuming a file-per-plant setup, e.g., plants/monstera.json)
        const res = await fetch(`plants/${plantId}.json`);
        
        // Handle cases where the file doesn't exist
        if (!res.ok) {
            document.getElementById("plant-profile").innerHTML = "<p>Plant not found.</p>";
            return;
        }

        // The response is now a single plant object, not an array
        const plant = await res.json();
        
        const profile = document.getElementById("plant-profile");
        
        // Use optional chaining (?.) to prevent crashes if a top-level object is missing
        // This is the most effective way to prevent the "Cannot read properties of undefined" error.
        
        profile.innerHTML = `
          <div class="profile-header">
            <div>
              <h2>${plant.scientificName}</h2>
              <p><strong><em>Etymology:</em></strong> ${plant.etymology}</p>
              <p><strong><em>Common Names:</em></strong> ${plant.commonNames?.join(", ") || 'N/A'}</p>
              <p><strong><em>History:</em>:</strong> ${plant.history}</p>
            </div>
            <img src="${plant.image}" alt="${plant.scientificName}">
          </div>

          <section class="battle-cards">
            <a href="#care" class="card">
              <h3><i class="fa-solid fa-seedling"></i> Care</h3>
              <p>${plant.care?.description || 'N/A'}</p>
            </a>

            <a href="#watering" class="card">
              <h3><i class="fa-solid fa-hand-holding-droplet"></i> Watering</h3>
              <p>${plant.watering?.description || 'N/A'}</p>
              <small><strong>Frequency:</strong> ${plant.watering?.frequency || 'N/A'}</small>
            </a>

            <a href="#light" class="card">
              <h3><i class="fa-solid fa-sun"></i> Light</h3>
              <p>${plant.light?.description || 'N/A'}</p>
              <small><strong>Ideal:</strong> ${plant.light?.idealHours || 'N/A'}</small>
            </a>

            <a href="#medium" class="card">
              <h3><i class="fa-brands fa-pagelines"></i> Growing Medium</h3>
              <p>${plant.medium?.description || 'N/A'}</p>
            </a>

            <a href="#propagation" class="card">
              <h3><i class="fa-solid fa-leaf"></i> Propagation</h3>
              <p>${plant.propagation?.description || 'N/A'}</p>
            </div>

            <a href="#toxicity" class="card">
              <h3><i class="fa-solid fa-book-skull"></i> Toxicity</h3>
              <p>${plant.toxicity?.description || 'N/A'}</p>
            </div>

            <div class="card">
              <h3><i class="fa-solid fa-temperature-half"></i> Temperature</h3>
              <p>${plant.temperature?.description || 'N/A'}</p>
              <small><strong>Ideal Range:</strong> ${plant.temperature?.idealRange || 'N/A'}</small>
            </div>

            
          </section>

          <section id="care" class="card full-width">
            <h3>Plant Care</h3>
            <div class="care-section">
              <h4>Essential Care Overview</h4>
              <div class="how-to-gallery">
                ${Array.isArray(plant.care?.howToImages) ? plant.care.howToImages.map(imgData => `
                  <figure>
                    <img src="${imgData.path}" alt="${imgData.caption}">
                    <figcaption>${imgData.caption}</figcaption>
                  </figure>
                `).join("") : ''}
              </div>
              <p>${plant.care?.detail || 'N/A'}</p>
            </div>

            <hr>

            <div class="care-section common-issues">
              <h4>Common Issues & Solutions</h4>
              <br>
              <div class="issue-list">
                <ul>
                  ${plant.care?.issues ? plant.care.issues.map(t => `<li>${t}</li>`).join("") : '<li>No common issues documented.</li>'}
                </ul>
              </div>
            </div>

            <hr>

            <div class="care-section additional-tips">
              <h4>Pro Tips for Success</h4>
              <ul>
                ${plant.care?.tips ? plant.care.tips.map(t => `<li>${t}</li>`).join("") : '<li>No tips available.</li>'}
              </ul>
            </div>
          </section>

          <section id="watering" class="card full-width">
            <h3>Watering</h3>
            <h4>How and When to Water</h4>
            <p>${plant.watering?.detail || 'N/A'}</p>
            <div class="how-to-gallery">
              ${Array.isArray(plant.watering?.howToImages) ? plant.watering.howToImages.map(imgData => `
                <figure>
                  <img src="${imgData.path}" alt="${imgData.caption}">
                  <figcaption>${imgData.caption}</figcaption>
                </figure>
              `).join("") : ''}
            </div>
          </section>

          <section id="light" class="card full-width">
            <h3>Light</h3>
            <h4>Providing the Right Light</h4>
            <p>${plant.light?.detail || 'N/A'}</p>
            <div class="how-to-gallery">
              ${Array.isArray(plant.light?.howToImages) ? plant.light.howToImages.map(imgData => `
                <figure>
                  <img src="${imgData.path}" alt="${imgData.caption}">
                  <figcaption>${imgData.caption}</figcaption>
                </figure>
              `).join("") : ''}
            </div>
            <ul>
              ${plant.light?.tips ? plant.light.tips.map(t => `<li>${t}</li>`).join("") : '<li>No tips available.</li>'}
            </ul>
          </section>

          <section id="medium" class="card full-width">
            <h3>Growing Medium</h3>
            <h4>The Right Mix for Your Plant</h4>
            <p>${plant.medium?.detail || 'N/A'}</p>
            <div class="how-to-gallery">
              ${Array.isArray(plant.medium?.howToImages) ? plant.medium.howToImages.map(imgData => `
                <figure>
                  <img src="${imgData.path}" alt="${imgData.caption}">
                  <figcaption>${imgData.caption}</figcaption>
                </figure>
              `).join("") : ''}
            </div>
            <ul>
              ${plant.medium?.tips ? plant.medium.tips.map(t => `<li>${t}</li>`).join("") : '<li>No tips available.</li>'}
            </ul>
          </section>

          <section id="propagation" class="card full-width">
            <h3>Propagation</h3>
            <h4>How to Propagate Your Plant</h4>
            <p>${plant.propagation?.detail || 'N/A'}</p>
            <div class="how-to-gallery">
              ${Array.isArray(plant.propagation?.howToImages) ? plant.propagation.howToImages.map(imgData => `
                <figure>
                  <img src="${imgData.path}" alt="${imgData.caption}">
                  <figcaption>${imgData.caption}</figcaption>
                </figure>
              `).join("") : ''}
            </div>
            <ul>
              ${plant.propagation?.tips ? plant.propagation.tips.map(t => `<li>${t}</li>`).join("") : '<li>No tips available.</li>'}
            </ul>
          </section>

          <section>
            <h3>Gallery</h3>
            <div class="gallery">
              ${Array.isArray(plant.gallery) ? plant.gallery.map((img, index) => `
                    <img src="${img}" alt="Image of plant in different settings">
              `).join("") : 'No gallery photos available.'}
            </div>
          </section>
        `;
      } catch (error) {
        document.getElementById("plant-profile").innerHTML = `<p>Error loading plant data. Please check the file path. ${error}</p>`;
        console.error("Error loading plant data:", error);
      }
    }
    loadPlant();
  </script>
</body>
</html>
